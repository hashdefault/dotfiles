#!/bin/bash

# Go to openweathermap.org, and create an account
KEY="your_api_key" 
ID="city_name,BR" #city_name,US/city_name,UK
UNIT="metric" #Options are 'metric' and 'imperial'

declare -A weather_icons

weather_icons["01d"]=" "
weather_icons["01n"]="󰖔 "
weather_icons["02d"]=" "
weather_icons["02n"]=" "
weather_icons["03d"]=" "
weather_icons["03n"]=" "
weather_icons["04d"]=" "
weather_icons["04n"]=" "
weather_icons["09d"]=" "
weather_icons["09n"]=" "
weather_icons["10d"]=" "
weather_icons["10n"]=" "
weather_icons["11d"]=" "
weather_icons["11n"]=" "
weather_icons["13d"]=" "
weather_icons["13n"]=" "
weather_icons["40d"]=" "
weather_icons["40n"]=" "
weather_icons["50d"]=" "
weather_icons["50n"]=" "

declare -A weather_colors

weather_colors["01d"]="#ffd86b"
weather_colors["01n"]="#fcdcf6"
weather_colors["02d"]="#adadff"
weather_colors["02n"]="#adadff"
weather_colors["03d"]="#adadff"
weather_colors["03n"]="#adadff"
weather_colors["04d"]="#adadff"
weather_colors["04n"]="#adadff"
weather_colors["09d"]="#6b95ff"
weather_colors["09n"]="#6b95ff"
weather_colors["10d"]="#6b95ff"
weather_colors["10n"]="#6b95ff"
weather_colors["11d"]="#ffeb57"
weather_colors["11n"]="#ffeb57"
weather_colors["13d"]="#e3e6fc"
weather_colors["13n"]="#e3e6fc"
weather_colors["40d"]="#84afdb"
weather_colors["40n"]="#84afdb"
weather_colors["50d"]="#84afdb"
weather_colors["50n"]="#84afdb"

weather=$(curl -sf "http://api.openweathermap.org/data/2.5/weather?APPID=$KEY&q=$ID&units=$UNIT")

if [ -n "$weather" ]; then

  weather_temp=$(echo "$weather" | jq ".main.temp" | cut -d "." -f 1)
  weather_icon_code=$(echo "$weather" | jq -r ".weather[].icon" | head -1)
  weather_description=$(echo "$weather" | jq -r ".weather[].description" | head -1 | sed -e "s/\b\(.\)/\u\1/g")

  echo "${weather_icons[$weather_icon_code]} $weather_description $weather_temp °C"
  echo "${weather_icons[$weather_icon_code]}" >/tmp/getweathertodayicon
  echo "$weather_temp °C" >/tmp/getweathertodaytemp
  echo "$weather_description" >/tmp/getweathertodaydesc
  echo "${weather_colors[$weather_icon_code]}" >/tmp/getweathertodayhex
else
  echo "Weather Unavailable  "
fi
