#!/bin/bash

dir_path="$HOME/Nextcloud/Notes"
rofi_theme="$HOME/.config/rofi/launcher/style"
prompt_icon="󱓧"
icon_theme="Oranchelo"

select_note() {
  ls -a1 "$1" | rofi \
    -modi "$prompt_icon :" \
    -show "$prompt_icon" \
    -theme "$rofi_theme" \
    -drun-icon-theme "$icon_theme" \
    -dmenu \
    -l 10 \
    -show-icons \
    -i \
    -p "$prompt_icon  Select notes or create one:"
}

launch_editor() {
  ghostty \
    --shell-integration='fish' \
    --working-directory="$dir_path" \
    --command="nvim \"$1\""
}

main() {
  while true; do
    selection=$(select_note "$dir_path")

    # Exit if no selection
    [ -z "$selection" ] && exit

    filepath="$dir_path/$selection"
    filetype=$(file --brief "$filepath")

    if [ -d "$filepath" ]; then
      # If directory, dive into it
      dir_path="$filepath"
    elif [[ "$filetype" == "Unicode text"* || "$filetype" == "ASCII text"* ]]; then
      break  # valid file
    else
      notify-send "  Not a text file. Try another."
    fi
  done

  launch_editor "$filepath"
}

main

