#!/bin/bash

dir_path="$HOME/Nextcloud/Notes"
list_notes=$(ls -a -1 $dir_path | rofi -modi "󱓧 :" -show "󱓧 " -theme $HOME/.config/rofi/launcher/style -drun-icon-theme "Oranchelo" -dmenu -l 10 -show-icons -i -p "󱓧  Select notes or create one:")
while [ true ]; do

  read -rsn1 key # Read 1 character silently
  if [[ $key == $'\e' ]]; then
    break
  fi

  filetype_selected="$(file --brief ${dir_path}/${list_notes})"
  if [ "$filetype_selected" == "directory" ]; then
    pkill rofi
    list_notes="${list_notes}/"$(ls -a -1 "$dir_path/$list_notes" | rofi -theme $HOME/.config/rofi/launcher/style -dmenu -show-icons -i -p '󱓧  Select notes or create one:')
  elif [[ "$filetype_selected" != *"Unicode text"* && $filetype_selected != "ASCII text" ]]; then
    notify-send "  Incorrect selection, try another file"
    pkill rofi
    list_notes=$(ls -a -1 "$dir_path" | rofi -show "󱓧 " -theme $HOME/.config/rofi/launcher/style -drun-icon-theme "Oranchelo" -dmenu -show-icons -i -p 'Select notes or create one:')
  else
    break
  fi
done

ghostty \
  --shell-integration='fish' \
  --working-directory="$dir_path" \
  --command="nvim \"$dir_path/$list_notes\""
